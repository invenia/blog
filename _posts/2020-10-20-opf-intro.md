---

layout: post

title: "A gentle introduction to Optimal Power Flow"

author: ""

comments: false

tags: power flow, optimal power flow, power grids



---

# Introduction
--------------

A central task of daily planning and operations of electricity grid operators[^1] is to dispatch generation in order to meet demand at minimum cost, while respecting reliability and security constraints. 
This requires to solve a constrained optimization problem often referred to as the Optimal Power Flow (OPF)[^2].

In this blog post we introduce the mathematical model of AC-OPF and discuss its most important variants.


# Power grids as graphs
-----------------------

Power grids are networks that include two main components: buses that can be generators, loads, both or neither and transmission (or distribution) lines that connect these buses.
It is pretty straightforward therefire to look at power grid networks as graphs: buses and transmission lines can be represented by the nodes and edges of the graph.
There are two equivalent graph models that can be used to derive power flow equations[^3]:
- undirected graph representation: $$\mathbb{G}(\mathcal{N}, \mathcal{E})$$
- directed graph representation: $$\mathbb{G}_{D}(\mathcal{N}, \mathcal{E}_{D})$$ 
where $$\mathcal{N}$$, $$\mathcal{E} \subseteq \mathcal{N} \times \mathcal{N}$$ and $$\mathcal{E}_{D} \subseteq \mathcal{N} \times \mathcal{N}$$ denote the set of nodes (buses), undirected and directed edges (transmission lines) of the graph, respectively.

# Complex power in AC curcuits
------------------------------

Power grids use alternating current curcuits (AC) so we start with some notations and definitions of AC curcuits.
We will consistently use capital and small letters to denote complex and real valued quantities.
For instance, let's consider two buses, $$i, j \in \mathcal{N}$$ that are directly connected a transmission line $$(i, j) \in \mathcal{E}$$.
The complex power flowing from bus $$i$$ to bus $$j$$ is denoted by $$S_{ij}$$ and it can be decomposed into its real ($$p_{ij}$$) and reactive ($$q_{ij}$$) components: 

$$S_{ij} = p_{ij} + jq_{ij}$$

, where $$j = \sqrt{-1}$$.
The complex power flow can be expressed by the complex voltage of bus $$i$$, $$V_{i}$$ and the complex conjugate of the current flowing between the buses, $$I_{ij}^{*}$$:

$$S_{ij} = V_{i}I_{ij}^{*}$$

Further, this current is a function of the admittance between the two buses ($$Y_{ij}$$):

$$I_{ij} = Y_{ij}(V_{i} - V_{j})$$ 

, where the admittance can be decomposed into real variables of conductance and susceptance: $$Y_{ij} = g_{ij} + jb_{ij}$$.
Also, we note that admittance is the reciprocal of impedance: $$Y_{ij} = \frac{1}{Z_{ij}}$$ and the impedance is composed of the resistance and reactance: $$Z_{ij} = r_{ij} + jx_{ij}$$.
Replacing the above expression for the current back to the power expression we get:

$$S_{ij} = V_{i}V_{i}^{*}Y_{ij}^{*} - V_{i}V_{j}^{*}Y_{ij}^{*}$$

Now we show two alterantive expressions of the above power flow using the polar form of voltage,  i.e. $$V_{i} = v_{i}e^{j \delta_{i}} = v_{i}(\cos\delta_{i} + j\sin\delta_{i})$$ (where $$v_{i}$$ and $$\delta_{i}$$ are the voltage magnitude and angle of bus $$i$$, respectively) and the admittance or impedance components:

$$S_{ij} = \left(g_{ij} - jb_{ij}\right) \left(v_{i}^{2} - v_{i}v_{j}\left(\cos\delta_{ij} + j\sin\delta_{ij}\right)\right) = \frac{r_{ij} + jx_{ij}}{r_{ij}^{2} + x_{ij}^{2}} \left( v_{i}^{2} - v_{i}v_{j}\left(\cos\delta_{ij} + j\sin\delta_{ij}\right)\right)$$

, where for brevity we introduced the voltage angle difference $$\delta_{ij} = \delta_{i} - \delta_{j}$$ and used a simple algebraic identity[^5] of $$g_{ij} - jb_{ij} = \frac{g_{ij}^{2} + b_{ij}^{2}}{g_{ij} + jb_{ij}} = \frac{|Y_{ij}|^{2}}{Y_{ij}} = \frac{Z_{ij}}{|Z_{ij}|^{2}} = \frac{r_{ij} + jx_{ij}}{r_{ij}^{2} + x_{ij}^{2}}$$
Finally, the corresponding real equations can be written as:

$$
\left\{
	\begin{aligned}
		p_{ij} & = g_{ij} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) - b_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) & = \frac{1}{r_{ij}^{2} + x_{ij}^{2}} \left[ r_{ij} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) + x_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) \right] \\
		q_{ij} & = b_{ij} \left( -v_{i}^{2} + v_{i} v_{j} \sin\delta_{ij} \right) - g_{ij} \left( v_{i} v_{j} \cos\delta_{ij} \right) & = \frac{1}{r_{ij}^{2} + x_{ij}^{2}} \left[ x_{ij} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) + r_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) \right] \\
	\end{aligned}
\right.
$$

# Power flow models
-------------------

In the previous section we presented the power flow between two connected buses and established a relationship between the complex power flow and complex voltages.
In power flow problems the entire power grid is considered and the task is to obtain certain quantities based on some specified ones.
There are two equivalent power flow models depending on the graph model used: bus injection model and branch flow model.

## Bus injection model
----------------------

Bus injection model (BIM) uses the undirected graph model of the power grid ($$\mathbb{G}(\mathcal{N}, \mathcal{E})$$).
For each bus $$i$$ we denote $$\mathcal{N}_{i} \subset \mathcal{N} $$ the set of buses directly connected to bus $$i$$.
Also, for each bus we introduce the following power quantities[^3][^4]:
- $$S_{i}^{G}$$: generated power flowing into bus $$i$$
- $$S_{i}^{L}$$: demand power or load flowing out of the bus $$i$$
- $$S_{i}$$: net power injection at bus $$i$$, i.e. $$S_{i} = S_{i}^{G} - S_{i}^{L}$$
- $$S_{i}^{T}$$: transmitted power flowing out of bus $$i$$ to adjacent buses

Based on [Tellegen's theorem](https://en.wikipedia.org/wiki/Tellegen%27s_theorem) the net power injection must be equal to the transmitted power for each bus:

$$S_{i} = S_{i}^{G} - S_{i}^{L} = S_{i}^{T} \ \ \ \ \forall i \in \mathcal{N}$$

 

---
[^1]: J. Tong, “Overview of PJM energy market design, operation and experience,” in 2004 IEEE International Conference on Electric Utility Deregulation, Restructuring and Power Technologies. Proceedings, vol. 1. IEEE, 2004, pp. 24–27. 
[^2]: M. B. Cain, R. P. Oneill, and A. Castillo, “History of optimal power flow and formulations,” Federal Energy Regulatory Commission, vol. 1, pp. 1–36, 2012.
[^3]: S. H. Low, "Convex Relaxation of Optimal Power Flow—Part I: Formulations and Equivalence," in IEEE Transactions on Control of Network Systems, vol. 1, no. 1, pp. 15-27, March 2014, doi: 10.1109/TCNS.2014.2309732.
[^4]: A. J. Wood, B. F. Wollenberg and G. B. Sheblé, Power generation, operation, and control. Hoboken, New Jersey: Wiley-Interscience, 2014
[^5]: H. Liu, L. Tesfatsion and A. A. Chowdhury, "Locational marginal pricing basics for restructured wholesale power markets," 2009 IEEE Power & Energy Society General Meeting, Calgary, AB, 2009, pp. 1-8, doi: 10.1109/PES.2009.5275503.
