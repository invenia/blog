---

layout: post

title: "A Gentle Introduction to Optimal Power Flow"

author: "Letif Mones"

comments: false

tags: power flow, optimal power flow, power grids



---

## Introduction
---------------

A central task of daily planning and operations of electricity grid operators[^Tong04] is to dispatch generation in order to meet demand at minimum cost, while respecting reliability and security constraints. 
This requires to solve a constrained optimization problem often referred to as some form of the optimal power flow (OPF)[^Cain12].

In this blog post we introduce the basic mathematical model of AC-OPF and briefly discuss its most important variants.
For this, first we introduce some basic definitions of power grids and AC circuits, then we define the power flow (PF) problem.

## Power grids as graphs
------------------------

Power grids are networks that include two main components: buses that can be generators, loads, both or neither, and transmission (or distribution) lines that connect these buses.
It is pretty straightforward therefore to look at power grid networks as graphs: buses and transmission lines can be represented by nodes and edges of a corresponding graph.
There are two equivalent graph models that can be used to derive the basic power flow equations[^Low14]:
- directed graph representation: $$\mathbb{G}_{D}(\mathcal{N}, \mathcal{E})$$ 
- undirected graph representation: $$\mathbb{G}_{U}(\mathcal{N}, \mathcal{E} \cup \mathcal{E}^{R})$$

where $$\mathcal{N}$$, $$\mathcal{E} \subseteq \mathcal{N} \times \mathcal{N}$$ and $$\mathcal{E}^{R} \subseteq \mathcal{N} \times \mathcal{N}$$ denote the set of nodes (buses), the forward and reverse orientation of directed edges (branches) of the graph, respectively.


![Power grid graphs]({{ site.baseurl }}/public/images/power_grid_graphs.png)
Figure 1. Directed graph representation of synthetic grid ieee-14 (left) and undirected graph representation of synthetic grid ieee-30 (right). Red and blue circles denote generator and load buses, respectively.


## Complex power in AC circuits
-------------------------------

Power grids use alternating current (AC) so we start with some notations and definitions of AC circuits.
We will consistently use capital and small letters to denote complex and real-valued quantities, respectively.
For instance, let us consider two buses, $$i, j \in \mathcal{N}$$ that are directly connected by a transmission line $$(i, j) \in \mathcal{E}$$.
The complex power flowing from bus $$i$$ to bus $$j$$ is denoted by $$S_{ij}$$ and it can be decomposed into its real ($$p_{ij}$$) and reactive ($$q_{ij}$$) components: 

$$S_{ij} = p_{ij} + jq_{ij}$$

where $$j = \sqrt{-1}$$.
The complex power flow can be expressed as the product of the complex voltage of bus $$i$$, $$V_{i}$$ and the complex conjugate of the current flowing between the buses, $$I_{ij}^{*}$$:

$$S_{ij} = V_{i}I_{ij}^{*}$$

Further, this current is a function of the line voltage drop and admittance between the two buses ($$Y_{ij}$$):

$$I_{ij} = Y_{ij}(V_{i} - V_{j}) \label{power_flow}$$ 

where the admittance can be decomposed into its components, the conductance and susceptance: $$Y_{ij} = g_{ij} + jb_{ij}$$.
Also, we note that the admittance is the reciprocal of the impedance: $$Y_{ij} = \frac{1}{Z_{ij}}$$ and the impedance is composed of the resistance and reactance: $$Z_{ij} = r_{ij} + jx_{ij}$$.
Replacing the above expression for the current back to the power flow expression (eq. $$\ref{power_flow}$$) we get:

$$S_{ij} = Y_{ij}^{*}V_{i}V_{i}^{*} - Y_{ij}^{*}V_{i}V_{j}^{*} = Y_{ij}^{*} \left( |V_{i}|^{2} - V_{i}V_{j}^{*} \right)$$

The above power flow equation can be expressed by using the polar form of voltage, i.e. $$V_{i} = v_{i}e^{j \delta_{i}} = v_{i}(\cos\delta_{i} + j\sin\delta_{i})$$ (where $$v_{i}$$ and $$\delta_{i}$$ are the voltage magnitude and angle of bus $$i$$, respectively) and the admittance components:

$$S_{ij} = \left(g_{ij} - jb_{ij}\right) \left(v_{i}^{2} - v_{i}v_{j}\left(\cos\delta_{ij} + j\sin\delta_{ij}\right)\right)$$

where for brevity we introduced the voltage angle difference $$\delta_{ij} = \delta_{i} - \delta_{j}$$.
Similarly, using a simple algebraic identity of $$g_{ij} - jb_{ij} = \frac{g_{ij}^{2} + b_{ij}^{2}}{g_{ij} + jb_{ij}} = \frac{|Y_{ij}|^{2}}{Y_{ij}} = \frac{Z_{ij}}{|Z_{ij}|^{2}} = \frac{r_{ij} + jx_{ij}}{r_{ij}^{2} + x_{ij}^{2}}$$ the impedance components based expression has the following form:

$$S_{ij} = \frac{r_{ij} + jx_{ij}}{r_{ij}^{2} + x_{ij}^{2}} \left( v_{i}^{2} - v_{i}v_{j}\left(\cos\delta_{ij} + j\sin\delta_{ij}\right)\right)$$

Finally, the corresponding real equations can be written as:

$$
\begin{equation}
\left\{
	\begin{aligned}
		p_{ij} & = g_{ij} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) - b_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) \\
		q_{ij} & = b_{ij} \left( -v_{i}^{2} + v_{i} v_{j} \cos\delta_{ij} \right) - g_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) \\
	\end{aligned}
\right.
\label{power_flow_y}
\end{equation}
$$

and

$$
\begin{equation}
\left\{
    \begin{aligned}
        p_{ij} & = \frac{1}{r_{ij}^{2} + x_{ij}^{2}} \left[ r_{ij} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) + x_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) \right] \\
        q_{ij} & = \frac{1}{r_{ij}^{2} + x_{ij}^{2}} \left[ x_{ij} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) + r_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) \right] \\
    \end{aligned}
\right.
\label{power_flow_z}
\end{equation}
$$

## Power flow models
--------------------

In the previous section we presented the power flow between two connected buses and established a relationship between the complex power flow and complex voltages.
In power flow problems the entire power grid is considered and the task is to obtain certain quantities based on some specified ones.
There are two equivalent power flow models depending on the graph model used: bus injection model and branch flow model.
First, we introduce the basic formulations and show their equivalence.
Then we show the most widely used technique to solve power flow systems.
And finally, we extend the basic equations and derive more sophisticated models for real power grids.

### Bus injection model
-----------------------

Bus injection model (BIM) uses the undirected graph model of the power grid, $$\mathbb{G}_{U}$$.
For each bus $$i$$ we denote by $$\mathcal{N}_{i} \subset \mathcal{N} $$ the set of buses directly connected to bus $$i$$.
Also, for each bus we introduce the following power quantities[^Low14] [^Wood14]:
- $$S_{i}^{\mathrm{gen}}$$: generated power flowing into bus $$i$$
- $$S_{i}^{\mathrm{load}}$$: demand power or load flowing out of the bus $$i$$
- $$S_{i}$$: net power injection at bus $$i$$, i.e. $$S_{i} = S_{i}^{\mathrm{gen}} - S_{i}^{\mathrm{load}}$$
- $$S_{i}^{\mathrm{trans}}$$: transmitted power flowing out of bus $$i$$ to adjacent buses

Based on [Tellegen's theorem](https://en.wikipedia.org/wiki/Tellegen%27s_theorem) the net power injection must be equal to the transmitted power for each bus:

$$S_{i} = S_{i}^{\mathrm{gen}} - S_{i}^{\mathrm{load}} = S_{i}^{\mathrm{trans}} \ \ \ \ \forall i \in \mathcal{N} \label{power_balance}$$

Eq. $$\ref{power_balance}$$ is a conservation low of power (energy).
In the most basic model a bus can be either a generator (i.e. $$S_{i} = S_{i}^{\mathrm{gen}}$$) or a load (i.e. $$S_{i} = -S_{i}^{\mathrm{load}}$$).
For a given bus the transmitted power can be obtained simply as a sum of the powers flowing out from the bus: $$S_{i}^{\mathrm{trans}} = \sum \limits_{j \in \mathcal{N}_{i}} S_{ij}$$.
Therefore, the basic BIM has the following concise form:

$$S_{i} = \sum \limits_{j \in \mathcal{N}_{i}} Y_{ij}^{*} \left( |V_{i}|^{2} - V_{i}V_{j}^{*} \right) \ \ \ \ \forall i \in \mathcal{N} \label{bim_basic_concise}$$

### The power flow problem
--------------------------

Eq. $$\ref{bim_basic_concise}$$
is a complex non-linear system with $$N = |\mathcal{N}|$$ number of complex equations and $$2N$$ number of complex variables: $$\left\{S_{i}, V_{i}\right\}_{i=1}^{N}$$.
Equivalently, either using the admittance (eq. $$\ref{power_flow_y}$$)
or impedance (eq. $$\ref{power_flow_z}$$)
components we can construct $$2N$$ number of real equations with $$4N$$ number of real variables: $$\left\{p_{i}, q_{i}, v_{i}, \delta_{i}\right\}_{i=1}^{N}$$, where $$S_{i} = p_{i} + jq_{i}$$.
The power flow problem is the following: for each bus we specify two of the four real variables and then using the $$2N$$ equations we derive the remaining ones. 
Depending on which variables are specified there are three basic types of buses:
- *slack* or $$V\delta$$ bus: it is usually a reference bus, where the voltage angle and magnitude are specified. Voltage angle is usually set to 0, while the magnitude to 1.0 per unit.
- *load* or $$PQ$$ bus: this is the most common bus type, where only demand but no power generation takes place. For such buses the active and reactive powers are specified.
- *generator* or $$PV$$ bus: this bus type specifies the active power and voltage magnitude variables.

Table 1. Basic bus types in power flow problem 

| Bus type  | Code        | Specified variables       |
| :-------- | :---------: | :-----------------------: |
| Slack     | $$V\delta$$ | $$v_{i}$$, $$\delta_{i}$$ |
| Load      | $$PQ$$      | $$p_{i}$$, $$q_{i}$$      |
| Generator | $$PV$$      | $$p_{i}$$, $$v_{i}$$      |


### Branch flow model
---------------------

We briefly describe an alternative formulation of the power flow problem, the branch flow model (BFM)[^Farivar13].
BFM is based on the directed graph representation of the grid network, $$\mathbb{G}_{D}$$.
Let us fix an arbitrary orientation of $$\mathbb{G}_{D}$$ and let $$(i, j) \in \mathcal{E}$$ denote an edge pointing from bus $$i$$ to bus $$j$$.
Then, the BFM is defined by the following set of complex equations:

$$
\begin{equation}
\left\{
	\begin{aligned}
		S_{i} & = \sum \limits_{(i, j) \in \mathcal{E}_{D}} S_{ij} - \sum \limits_{(k, i) \in \mathcal{E}} \left( S_{ki} - Z_{ki} |I_{ki}|^{2} \right) & \forall i \in \mathcal{N} \\
		I_{ij} & = Y_{ij} \left( V_{i} - V_{j} \right) & \forall (i, j) \in \mathcal{E} \\
		S_{ij} & = V_{i}I_{ij}^{*} & \forall (i, j) \in \mathcal{E} \\
	\end{aligned}
\right.
\label{bfm_basic_concise}
\end{equation}
$$

where the first, second and third sets of equations correspond to the power balance, Ohm's low and branch power definition, respectively.

Let $$N = |\mathcal{N}|$$ and $$E = |\mathcal{E}|$$ denote the number of nodes and directed edges, respectively.
BFM includes $$N + 2E$$ complex equations with $$2N + 2E$$ complex variables: $$\left\{ S_{i}, V_{i} \right\}_{i \in \mathcal{N}} \cup \left\{ S_{ij}, I_{ij} \right\}_{(i, j) \in \mathcal{E}}$$ or equivalently, $$2N + 4E$$ real equations with $$4N + 4E$$ real variables.

### BIM vs BFM
--------------

BIM and BFM are equivalent formulations, i.e. there is a bijection that maps the solution sets between the two models[^Subhonmesh12].
Below we demonstrate their equivalence starting from the BFM power balance equation:

$$
\begin{equation}
	\begin{aligned}
		S_{i}^{\mathrm{BFM}} & = \sum \limits_{(i, j) \in \mathcal{E}} S_{ij} - \sum \limits_{(k, i) \in \mathcal{E}} \left( S_{ki} - Z_{ki} |I_{ki}|^{2} \right) \\
		& = \sum \limits_{(i, j) \in \mathcal{E}} S_{ij} - \sum \limits_{(k, i) \in \mathcal{E}} \left( S_{ki} - Z_{ki} Y_{ki} \left( V_{k} - V_{i} \right) Y_{ki}^{*} \left( V_{k}^{*} - V_{i}^{*} \right) \right) \\
		& = \sum \limits_{(i, j) \in \mathcal{E}} S_{ij} - \sum \limits_{(k, i) \in \mathcal{E}} \left( S_{ki} - Y_{ki}^{*} \left( \lvert V_{k} \rvert^{2} - V_{k} V_{i}^{*} \right) - Y_{ki}^{*} \left( \lvert V_{i} \rvert^{2} - V_{i} V_{k}^{*} \right) \right) \\
		& = \sum \limits_{(i, j) \in \mathcal{E}} S_{ij} + \sum \limits_{(k, i) \in \mathcal{E}} \left( Y_{ik}^{*} \left( \lvert V_{i} \rvert^{2} - V_{i} V_{k}^{*}\right) \right) \\
		& = \sum \limits_{(i, j) \in \mathcal{E}} \left( Y_{ij}^{*} \left( \lvert V_{i} \rvert^{2} - V_{i} V_{j}^{*}\right) \right) + \sum \limits_{(k, i) \in \mathcal{E}} \left( Y_{ik}^{*} \left( \lvert V_{i} \rvert^{2} - V_{i} V_{k}^{*}\right) \right) \\
		& = \sum \limits_{i \in \mathcal{N}_{i}} \left( Y_{ij}^{*} \left( \lvert V_{i} \rvert^{2} - V_{i} V_{j}^{*}\right) \right) = S_{i}^{\mathrm{BIM}} \ \ \ \ \forall i \in \mathcal{N} \\
	\end{aligned}
\end{equation}
$$

where we used Ohm's low $$\left( I_{ki} = Y_{ki} \left( V_{k} - V_{i} \right) \right)$$, the relation between impedance and admittance $$\left( Z_{ki} Y_{ki} = 1 \right)$$, the definition of branch flow $$\left( S_{ki} = Y_{ki}^{*} \left( \lvert V_{k} \rvert^{2} - V_{k} V_{i}^{*} \right) \right)$$ and the symmetry of admittance $$\left( Y_{ki} = Y_{ik} \right)$$.

Although the formulations are equivalent, in practice we might prefer one model over the other: depending on the actual problem and the structure of the system it might be easier to obtain results and derive exact or approximate relaxation from one formulation than from the other one.

Table 2. Comparison of basic BIM and BFM formulations: complex variables, number of complex variables and equations. Corresponding real variables, their numbers as well as the number of real equations are also shown in parentheses.

| Formulation | Variables | Number of variables | Number of equations |
| :---------: | :-------: | :-----------------: | :-----------------: |
| BIM         | $$V_{i} \ (v_{i}, \delta_{i})$$ <br> $$S_{i} \ (p_{i}, q_{i})$$ | $$2N$$ <br> $$(4N)$$ | $$N$$ <br> $$(2N)$$ |
| BFM         | $$V_{i} \ (v_{i}, \delta_{i})$$ <br> $$S_{i} \ (p_{i}, q_{i})$$ <br> $$I_{ij} \ (i_{ij}, \gamma_{ij})$$ <br> $$S_{ij} \ (p_{ij}, q_{ij})$$ | $$2N + 2E$$ <br> $$(4N + 4E)$$ | $$N + 2E$$ <br> $$(2N + 4E)$$ | 


### Solving the power flow problem
----------------------------------

Power flow problems (both BIM and BFM) define a non-linear system of equations.
There are multiple approaches to solve power flow systems but the most widely used technique is the Newton–Raphson method.
Below we demonstrate how it can be applied to the BIM formulation.
First, we rearrange eq. $$\ref{bim_basic_concise}$$:

$$ F_{i} = S_{i} - \sum \limits_{j \in \mathcal{N}_{i}} Y_{ij}^{*} \left( |V_{i}|^{2} - V_{i}V_{j}^{*} \right) = 0 \ \ \ \ \forall i \in \mathcal{N} $$

The above set of equations can be expressed simply as $$F(X) = 0$$, where $$X$$ denotes the $$N$$ number of complex or more conveniently, the $$2N$$ number of real unknown variables and $$F$$ represents the $$N$$ number of complex or $$2N$$ number of real equations.

In [Newton-Raphson method](https://en.wikipedia.org/wiki/Newton%27s_method) the solution is sought in an iterative fashion until a certain threshold of convergence is satisfied.
In the $$(n+1)$$th iteration we obtain:

$$X_{n+1} = X_{n} - J_{F}(X_{n})^{-1} F(X_{n})$$

where $$J_{F}$$ is the Jacobian matrix with $$\left[J_{F}\right]_{ij} = \frac{\partial F_{i}}{\partial X_{j}}$$ elements.
We also note that instead of computing the inverse of the Jacobian matrix, a numerically more stable approach is to solve first a linear system of $$J_{F}(X_{n}) \Delta X_{n} = -F(X_{n})$$ and then obtain $$X_{n+1} = X_{n} + \Delta X_{n}$$.

Since Newton-Raphson method requires only the computation of first derivatives of the $$F_{i}$$ functions with respect to the variables, this technique is in general very efficient even for large, real-size grids.

### Towards more realistic power flow models
--------------------------------------------

In the previous sections we introduced the main concept of the power flow problem.
However, the derived models were rather basic ones and real systems require more reasonable approaches.
Below we will construct more sophisticated models by extending the basic equations considering the followings:
- multiple generators and loads included by buses
- shunt elements connected to buses
- modeling transformers and phase shifters
- modeling asymmetric line charging

We note that actual power grids can include additional elements besides the ones we discuss.

#### Improving the bus model
----------------------------

We start with the generated ($$S_{i}^{\mathrm{gen}}$$) and load ($$S_{i}^{\mathrm{load}}$$) powers in the balance equations, i.e. $$S_{i} = S_{i}^{\mathrm{gen}} - S_{i}^{\mathrm{load}} = S_{i}^{\mathrm{trans}}$$ for each bus $$i$$.
Electric grid buses can actually include multiple generators and loads together.
In order to take this structure into account we introduce $$\mathcal{G}_{i}$$ and $$\mathcal{L}_{i}$$ that denote the set of generators and the set of loads at bus $$i$$, respectively.
Also, $$\mathcal{G} = \bigcup \limits_{i \in \mathcal{N}} \mathcal{G}_{i}$$ and $$\mathcal{L} = \bigcup \limits_{i \in \mathcal{N}} \mathcal{L}_{i}$$ indicate the sets of all generators and loads, respectively.
Then we can write the following complex-valued expressions:

$$S_{i}^{\mathrm{gen}} = \sum \limits_{g \in \mathcal{G}_{i}} S_{g}^{G} \ \ \ \ \forall i \in \mathcal{N}$$

$$S_{i}^{\mathrm{load}} = \sum \limits_{l \in \mathcal{L}_{i}} S_{l}^{L} \ \ \ \ \forall i \in \mathcal{N}$$

where $$\left\{S_{g}^{G}\right\}_{g \in \mathcal{G}}$$ and $$\left\{S_{l}^{L}\right\}_{l \in \mathcal{L}}$$ are the complex powers of generator dispatches and load consumptions, respectively.
It is easy to see from the equations above that having multiple generators and loads per bus increases the total number of variables, while the number of equations does not change.
If the system includes $$N = \lvert \mathcal{N} \rvert$$ number of buses, $$G = \lvert \mathcal{G} \rvert$$ number of generators and $$L = \lvert \mathcal{L} \rvert$$ number of loads then the total number of complex variables changes to $$N + G + L$$ and $$N + G + L + 2E$$ for BIM and BFM, respectively.

Buses can also include shunt elements that are used to model connected capacitors and inductors.
They are represented by individual admittances resulting in additional power flowing out of the bus:

$$S_{i} = S_{i}^{\mathrm{gen}} - S_{i}^{\mathrm{load}} - S_{i}^{\mathrm{shunt}} = \sum \limits_{g \in \mathcal{G}_{i}} S_{g}^{G} - \sum \limits_{l \in \mathcal{L}_{i}} S_{l}^{L} - \sum \limits_{s \in \mathcal{S}_{i}} S_{s}^{S} \ \ \ \ \forall i \in \mathcal{N}$$ 

where $$\mathcal{S}_{i}$$ is the set of shunts attached to bus $$i$$ and $$S^{S}_{s} = \left( Y_{s}^{S} \right)^{*} \lvert V_{i} \rvert^{2}$$ with admittance $$Y_{s}^{S}$$ of shunt $$s \in \mathcal{S}_{i}$$.
Shunt elements do not introduce additional variables in the system.

#### Improving the branch model
-------------------------------

In real power grids branches can be transmission lines, transformers or phase shifters.
Transformers are used to control voltages, real and sometimes reactive power flows.
In this section we take the transformer and line charging also into account by a general branch model (Figure 2).


![Branch model]({{ site.baseurl }}/public/images/branch_model.png)
Figure 2. General branch model including transformers and $$\pi$$-section model (source: MATPOWER manual[^Zimmerman20]).


Transformers (and also phase shifters) are represented by the complex tap ratio $$T_{ij}$$ or equivalently with its magnitude $$t_{ij}$$ and phase angle $$\theta_{ij}$$.
Also, line charging is usually modeled by the $$\pi$$ transmission line (or $$\pi$$-section) model that places shunt admittances at the two ends of the transmission line beside its series admittance.
We will treat the shunt admittances in a fairly general way, i.e. $$Y_{ij}^{C}$$ and $$Y_{ji}^{C}$$ are not necessarily equal but we also note that a widely used practice is to use equal values and considering their susceptance component only.
Apparently, this model is not symmetric anymore and for consistency we introduce the following convention: we select the orientation of each branch $$(i, j) \in \mathcal{E}$$ that matches the structure presented in Figure 2.
We have then the following equations for the currents:

$$
\begin{equation}
    \begin{aligned}
	& T_{ij}^{*} I_{ij} = I_{ij}^{s} + Y_{ij}^{C} \frac{V_{i}}{T_{ij}} & \implies & I_{ij} = \frac{I_{ij}^{s}}{T_{ij}^{*}} + Y_{ij}^{C} \frac{V_{i}}{\lvert T_{ij} \rvert^{2}} & \quad \forall (i, j) \in \mathcal{E} \\
	& I_{ji} = I_{ji}^{s} + Y_{ji}^{C} V_{j} & \implies & I_{ji} = -I_{ij}^{s} + Y_{ji}^{C} V_{j} & \quad \forall (j, i) \in \mathcal{E}^{R}
	\end{aligned}
\end{equation}
$$

where $$I_{ij}^{s} = Y_{ij} \left( \frac{V_{i}}{T_{ij}} - V_{j} \right)$$ is the series current.
Now we can easily obtain the corresponding power flows:

$$
\begin{equation}
	\begin{aligned}
	S_{ij} & = V_{i}I_{ij}^{*} = V_{i} \left( \frac{I_{ij}^{s}}{T_{ij}^{*}} + Y_{ij}^{C} \frac{V_{i}}{\lvert T_{ij} \rvert^{2}}\right)^{*} & \\
           & = Y_{ij}^{*} \left( \frac{\lvert V_{i} \rvert^{2}}{\lvert T_{ij} \rvert^{2}} - \frac{V_{i} V_{j}^{*}}{T_{ij}} \right) + \left( Y_{ij}^{C} \right)^{*} \frac{\lvert V_{i} \rvert^{2}}{\lvert T_{ij} \rvert^{2}} \ \ \ \ & \forall (i, j) \in \mathcal{E} \\
	S_{ji} & = V_{j}I_{ji}^{*} = V_{j} \left( -I_{ij}^{s} + Y_{ji}^{C}V_{j} \right)^{*} & \\
           & = Y_{ij}^{*} \left( \lvert V_{j} \rvert^{2} - \frac{V_{j}V_{i}^{*}}{T_{ij}^{*}} \right) + \left( Y_{ji}^{C} \right)^{*} \lvert V_{j} \rvert^{2} \ \ \ \ & \forall (j, i) \in \mathcal{E}^{R} \\
	\end{aligned}
\end{equation}
$$

### Improved BIM and BFM models
-------------------------------

Putting everything together from the previous sections we present the improved BIM and BFM models:

BIM:

$$
\begin{equation} 
	\begin{aligned}
		\sum \limits_{g \in \mathcal{G}_{i}} S_{g}^{G} - \sum \limits_{l \in \mathcal{L}_{i}} S_{l}^{L} - \sum \limits_{s \in \mathcal{S}_{i}} \left( Y_{s}^{S} \right)^{*} \lvert V_{i} \rvert^{2} = \sum \limits_{(i, j) \in \mathcal{E}} Y_{ij}^{*} \left( \frac{\lvert V_{i} \rvert^{2}}{\lvert T_{ij} \rvert^{2}} - \frac{V_{i} V_{j}^{*}}{T_{ij}} \right) + \left( Y_{ij}^{C} \right)^{*} \frac{\lvert V_{i} \rvert^{2}}{\lvert T_{ij} \rvert^{2}} \\
        + \sum \limits_{(k, i) \in \mathcal{E}^{R}} Y_{ik}^{*} \left( \lvert V_{k} \rvert^{2} - \frac{V_{k}V_{i}^{*}}{T_{ik}^{*}} \right) + \left( Y_{ki}^{C} \right)^{*} \lvert V_{k} \rvert^{2} \ \ \ \ \forall i \in \mathcal{N} \\
	\end{aligned}
\label{bim_concise}
\end{equation}
$$

BFM:

$$
\begin{equation} 
    \begin{aligned}
		& \sum \limits_{g \in \mathcal{G}_{i}} S_{g}^{G} - \sum \limits_{l \in \mathcal{L}_{i}} S_{l}^{L} - \sum \limits_{s \in \mathcal{S}_{i}} \left( Y_{s}^{S} \right)^{*} \lvert V_{i} \rvert^{2} = \sum \limits_{(i, j) \in \mathcal{E}} S_{ij} + \sum \limits_{(k, i) \in \mathcal{E}^{R}} S_{ki} & \forall i \in \mathcal{N} \\
		& I_{ij}^{s} = Y_{ij} \left( \frac{V_{i}}{T_{ij}} - V_{j} \right) & \forall (i, j) \in \mathcal{E} \\
		& S_{ij} = V_{i} \left( \frac{I_{ij}^{s}}{T_{ij}^{*}} + Y_{ij}^{C} \frac{V_{i}}{\lvert T_{ij} \rvert^{2}}\right)^{*} & \forall (i, j) \in \mathcal{E} \\
		& S_{ji} = V_{j} \left( -I_{ij}^{s} + Y_{ji}^{C}V_{j} \right)^{*} & \forall (j, i) \in \mathcal{E}^{R} \\
	\end{aligned}
\label{bfm_concise}
\end{equation}
$$

Table 3. Comparison of improved BIM and BFM formulations: complex variables, number of complex variables and equations. Corresponding real variables, their numbers as well as the number of real equations are also shown in parentheses.

| Formulation | Variables | Number of variables | Number of equations |
| :---------: | :-------: | :-----------------: | :-----------------: |
| BIM         | $$V_{i} \ (v_{i}, \delta_{i})$$ <br> $$S_{g}^{G} \ (p_{g}^{G}, q_{g}^{G})$$ <br> $$S_{l}^{L} \ (p_{l}^{L}, q_{l}^{L})$$ | $$N + G + L$$ <br> $$(2N + 2G + 2L)$$ | $$N$$ <br> $$(2N)$$ |
| BFM         | $$V_{i} \ (v_{i}, \delta_{i})$$ <br> $$S_{g}^{G} \ (p_{g}^{G}, q_{g}^{G})$$ <br> $$S_{l}^{L} \ (p_{l}^{L}, q_{l}^{L})$$ <br> $$I_{ij}^{s} \ (i_{ij}^{s}, \gamma_{ij}^{s})$$ <br> $$S_{ij} \ (p_{ij}, q_{ij})$$ <br> $$S_{ji} \ (p_{ji}, q_{ji})$$ | $$N + G + L + 3E$$ <br> $$(2N + 2G + 2L + 6E)$$ | $$N + 3E$$ <br> $$(2N + 6E)$$ |


## The optimal power flow problem 
---------------------------------

Optimal power flow (OPF) is an umbrella term that covers a wide range of constrained optimization problems based on the power flow problem.
The most important ingredients of the models are: *variables* that minimize an *objective function*, subject to some *equality constraints* including the power balance and power flow equations and *inequality constraints* including bounds on the variables.
Depending on the actual type of the OPF the form of the objective, as well as the sets of variables and constraints, vary.
First, we derive the economic dispatch problem and show how to solve it.
Then we provide a brief overview of other basic types of OPF.
We will see that - unlike PF - OPF is in general rather expensive to solve so finally we also discuss approximations that simplify the original model (relaxation) and computational intelligence and machine learning techniques that try to reduce real-time computational cost.

### Economic dispatch problem
-----------------------------

Our starting OPF model is the economic dispatch (ED) model.
We derive two equivalent formulations of ED using the improved BIM and BMF models.
Then we discuss the interior point method, which is one of the most widely used techniques to solve ED problems.

#### Variables
-------------

In power flow problems the difference between the number of variables and equations determines the maximum number of unknown variables for which we can solve the non-linear system.
For instance, based on Table 3 it means $$G+L$$ number of complex (or $$2G + 2L$$ real) unknown variables for both BIM and BFM formulations.

In ED the variables are basically the same as in the power flow problems but as an optimization problem, ED has a higher number of unknown variables.
For generality, in this discussion formally we treat all of these variables in ED as unknown.
For variables, whose value is actually specified we can simply define an equality constraint or more typically, the corresponding lower and upper bounds with the same specific value.
This latter formalism makes the model construction more straightforward and it also follows the general practice of implementations[^Coffrin18].
For the following sections let $$X$$ generally denote all variables in ED.

#### Objective function
----------------------

The objective (or cost) function of the most widely used economic dispatch OPF is the cost of the total real power generation.
Let $$C_{g} = C_{g}(p_{g}^{G})$$ denote the individual cost curve of generator $$g \in \mathcal{G}$$ that is a function solely depending on the power generated in generator $$g$$.
$$C_{g}$$ is a monotonically increasing function of $$p_{g}^{G}$$, usually modeled by a quadratic or piecewise linear function.
The objective function, $$C(X)$$, then can be written as:

$$C(X) = \sum \limits_{g \in \mathcal{G}} C_{g}(p_{g}^{G})$$

We note that there can be alternative objective functions in OPF that can be used to investigate different features of the power grid[^AlRashidi09].
For instance, one can minimize the line loss over the network.
Also, the objective function can express additional environmental and economical costs other than pure generation cost.
As an example, with the increasing concerns over climate change, multiple studies have suggested that reducing overall emissions from generation should be also taken into account in the objective function[^Gholami14].

#### Equality constraints 
-------------------------

Since power flow equations express fundamental physical lows they are of course must be included in any OPF.
Since BIM and BFM are equivalent formulations, both can be used in ED: power balance equations together with the power flow equations (i.e. eq. $$\ref{bim_concise}$$
and eq. $$\ref{bfm_concise}$$ 
for BIM and BFM, respectively) are treated as equality constraints in OPF.

An additional equality constraint is applied for the reference bus by setting its voltage angle to 0.
In a more general setting there can be multiple reference nodes and corresponding constraints on their voltage angle.
Denoting the set of all reference nodes by $$\mathcal{R}$$ we can write this set of constraints as: $$\delta_{r} = 0 \ \ \ \ \forall r \in \mathcal{R}$$.

#### Inequality constraints
--------------------------- 

Finally, OPFs also include a set of inequality constraints on the variables that usually express some physical limitations of the elements of the system.
For example, the most typical constraints of the ED problem are the followings:
- lower and upper bounds on voltage magnitudes: $$\underline{v}_{i} \le v_{i} \le \overline{v}_{i} \ \ \ \ \forall i \in \mathcal{N}$$
- lower and upper bounds on voltage angle differences: $$\underline{\delta}_{ij} \le \delta_{ij} \le \overline{\delta}_{ij} \ \ \ \ \forall (i, j) \in \mathcal{E}$$
- lower and upper bounds on generated active powers: $$\underline{p}_{i}^{G} \le p_{i}^{G} \le \overline{p}_{i}^{G} \ \ \ \ \forall i \in \mathcal{N}$$
- lower and upper bounds on generated reactive powers: $$\underline{q}_{i}^{G} \le q_{i}^{G} \le \overline{q}_{i}^{G} \ \ \ \ \forall i \in \mathcal{N}$$
- upper bounds on the absolute value of active power flow: $$\lvert p_{ij}\rvert \le \overline{p}_{ij} \ \ \ \ \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R}$$
- upper bounds on the absolute value of reactive power flow: $$\lvert q_{ij}\rvert \le \overline{q}_{ij} \ \ \ \ \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R}$$
- upper bound on the absolute (square) value of complex power flow: $$\lvert S_{ij}\rvert^{2} = p_{ij}^{2} + q_{ij}^{2} \le \overline{S}_{ij}^{2} \ \ \ \ \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R}$$

We note that in actual implementation some inequality constraints can appear in alternative form.
For instance, lower and upper bounds on power flows can be replaced by a corresponding set of constraints on the branch currents.

#### Economic dispatch problem using BIM
----------------------------------------

Putting everything together the concise form of the economic dispatch OPF using BIM is the following:

$$
\begin{equation}
	\begin{aligned}
		& \underline{\mathrm{variables}}: \\
		& \quad X^{\mathrm{BIM}}
			\begin{cases}
				& V_{i} = (v_{i}, \delta_{i}) & \forall i \in \mathcal{N} \\
				& S_g^{G} = (p_{g}^{G}, q_{g}^{G}) & \forall g \in \mathcal{G} \\
				& S_{ij} = (p_{ij}, q_{ij}) & \forall (i, j) \in \mathcal{E} \\
				& S_{ji} = (p_{ji}, q_{ji}) & \forall (j, i) \in \mathcal{E}^{R} \\ 
			\end{cases} \\
		& \underline{\mathrm{objective}}: \\
		& \quad \min \limits_{X^{\mathrm{BIM}}} C_{g}(p_{g}^{G}) \\
		& \underline{\mathrm{subject\ to}}: \\
		& \quad \boxed{\mathcal{C}^{\mathrm{PB}}} \\
				& \qquad \sum \limits_{g \in \mathcal{G}_{i}} S_{g}^{G} - \sum \limits_{l \in \mathcal{L}_{i}} S_{l}^{L} - \sum \limits_{s \in \mathcal{S}_{i}} \left( Y_{s}^{S} \right)^{*} \lvert V_{i} \rvert^{2} = \sum \limits_{(i, j) \in \mathcal{E}} S_{ij} + \sum \limits_{(k, i) \in \mathcal{E}^{R}} S_{ki} & \forall i \in \mathcal{N} \\
		& \quad \boxed{\mathcal{C}^{\mathrm{REF}}} \\
				& \qquad \delta_{r} = 0 & \forall r \in \mathcal{R} \\
		& \quad \boxed{\mathcal{C}^{\mathrm{BIM}}} \\
				& \qquad S_{ij} = Y_{ij}^{*} \left( \frac{\lvert V_{i} \rvert^{2}}{\lvert T_{ij} \rvert^{2}} - \frac{V_{i} V_{j}^{*}}{T_{ij}} \right) + \left( Y_{ij}^{C} \right)^{*} \frac{\lvert V_{i} \rvert^{2}}{\lvert T_{ij} \rvert^{2}} & \forall (i, j) \in \mathcal{E} \\ 
				& \qquad S_{ji} = Y_{ij}^{*} \left( \lvert V_{j} \rvert^{2} - \frac{V_{j}V_{i}^{*}}{T_{ij}^{*}} \right) + \left( Y_{ji}^{C} \right)^{*} \lvert V_{j} \rvert^{2} & \forall (j, i) \in \mathcal{E}^{R} \\
		& \quad \boxed{\mathcal{C}^{\mathrm{INEQ}}} \\
				& \qquad \underline{v}_{i} \le v_{i} \le \overline{v}_{i} & \forall i \in \mathcal{N} \\
				& \qquad \underline{p}_{i}^{G} \le p_{i}^{G} \le \overline{p}_{i}^{G} & \forall i \in \mathcal{N} \\
				& \qquad \underline{p}_{i}^{G} \le p_{i}^{G} \le \overline{p}_{i}^{G} & \forall i \in \mathcal{N} \\
				& \qquad \underline{\delta}_{ij} \le \delta_{ij} \le \overline{\delta}_{ij} & \forall (i, j) \in \mathcal{E} \\
				& \qquad \lvert p_{ij}\rvert \le \overline{p}_{ij} & \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R} \\
				& \qquad \lvert q_{ij}\rvert \le \overline{q}_{ij} & \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R}	\\
			    & \qquad \lvert S_{ij}\rvert^{2} = p_{ij}^{2} + q_{ij}^{2} \le \overline{S}_{ij}^{2} & \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R} \\
	\end{aligned}
\label{opf_bim}
\end{equation}
$$

where $$\mathcal{C}^{\mathrm{PB}}$$, $$\mathcal{C}^{\mathrm{REF}}$$, $$\mathcal{C}^{\mathrm{BIM}}$$ denote the equality sets for the power balance, the voltage angle of reference buses and the improved BIM, respectively, while $$\mathcal{C}^{\mathrm{INEQ}}$$ is the set of inequality constraints.

#### Economic dispatch problem using BFM
----------------------------------------

Similarly, the concise form of the economic dispatch OPF using BFM is the following:

$$
\begin{equation}
    \begin{aligned}
        & \underline{\mathrm{variables}}: \\
        & \quad X^{\mathrm{BFM}}
            \begin{cases}
                & V_{i} = (v_{i}, \delta_{i}) & \forall i \in \mathcal{N} \\
                & S_g^{G} = (p_{g}^{G}, q_{g}^{G}) & \forall g \in \mathcal{G} \\
                & S_{ij} = (p_{ij}, q_{ij}) & \forall (i, j) \in \mathcal{E} \\
                & S_{ji} = (p_{ji}, q_{ji}) & \forall (j, i) \in \mathcal{E}^{R} \\
				& I_{ij}^{s} = (i_{ij}^{s}, \gamma_{ij}^{s}) & \forall (i, j) \in \mathcal{E} \\ 
            \end{cases} \\
        & \underline{\mathrm{objective}}: \\
        & \quad \min \limits_{X^{\mathrm{BFM}}} C_{g}(p_{g}^{G}) \\
        & \underline{\mathrm{subject\ to}}: \\
        & \quad \boxed{\mathcal{C}^{\mathrm{PB}}} \\
                & \qquad \sum \limits_{g \in \mathcal{G}_{i}} S_{g}^{G} - \sum \limits_{l \in \mathcal{L}_{i}} S_{l}^{L} - \sum \limits_{s \in \mathcal{S}_{i}} \left( Y_{s}^{S} \right)^{*} \lvert V_{i} \rvert^{2} = \sum \limits_{(i, j) \in \mathcal{E}} S_{ij} + \sum \limits_{(k, i) \in \mathcal{E}^{R}} S_{ki} & \forall i \in \mathcal{N} \\
        & \quad \boxed{\mathcal{C}^{\mathrm{REF}}} \\
                & \qquad \delta_{r} = 0 & \forall r \in \mathcal{R} \\
        & \quad \boxed{\mathcal{C}^{\mathrm{BFM}}} \\
				& \qquad I_{ij}^{s} = Y_{ij} \left( \frac{V_{i}}{T_{ij}} - V_{j} \right) & \forall (i, j) \in \mathcal{E} \\
                & \qquad S_{ij} = V_{i} \left( \frac{I_{ij}^{s}}{T_{ij}^{*}} + Y_{ij}^{C} \frac{V_{i}}{\lvert T_{ij} \rvert^{2}}\right)^{*} & \forall (i, j) \in \mathcal{E} \\
                & \qquad S_{ji} = V_{j} \left( -I_{ij}^{s} + Y_{ji}^{C}V_{j} \right)^{*} & \forall (j, i) \in \mathcal{E}^{R} \\
        & \quad \boxed{\mathcal{C}^{\mathrm{INEQ}}} \\
                & \qquad \underline{v}_{i} \le v_{i} \le \overline{v}_{i} & \forall i \in \mathcal{N} \\
                & \qquad \underline{p}_{i}^{G} \le p_{i}^{G} \le \overline{p}_{i}^{G} & \forall i \in \mathcal{N} \\
                & \qquad \underline{p}_{i}^{G} \le p_{i}^{G} \le \overline{p}_{i}^{G} & \forall i \in \mathcal{N} \\
				& \qquad \underline{\delta}_{ij} \le \delta_{ij} \le \overline{\delta}_{ij} & \forall (i, j) \in \mathcal{E} \\
                & \qquad \lvert p_{ij}\rvert \le \overline{p}_{ij} & \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R} \\
                & \qquad \lvert q_{ij}\rvert \le \overline{q}_{ij} & \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R}    \\
                & \qquad \lvert S_{ij}\rvert^{2} = p_{ij}^{2} + q_{ij}^{2} \le \overline{S}_{ij}^{2} & \forall (i, j) \in \mathcal{E} \cup \mathcal{E}^{R} \\
    \end{aligned}
\label{opf_bmf}
\end{equation}
$$

where beside the previously introduced sets, $$\mathcal{C}^{\mathrm{BFM}}$$ is the set of equality constraints of BFM. 

#### Solving the ED problem by the interior-point method
--------------------------------------------------------

Economic dispatch is a non-linear non-convex optimization problem.
One of the most successful techniques to solve such large-scale programming is the interior-point or barrier method.[^Nocedal06] [^Wachter06]
In this section we briefly discuss the main points of the method.

The ED problem can be expressed by the following concise form:

$$
\begin{equation}
	\begin{aligned}
		& \min \limits_{x} \ f(x) \\
		& \mathrm{s.t.} \; \; c^{\mathrm{E}}(x) = 0 \\
		& \quad \; \; \; c^{\mathrm{I}}(x) \ge 0 \\
	\end{aligned}
	\label{opt_problem}
\end{equation}
$$

where $$x$$ denotes the vector of variables, $$f(x)$$ is the objective function and $$c^{\mathrm{E}}$$ and $$c^{\mathrm{I}}$$ represent the (rearranged) equality and inequality constraints, respectively.
For example, using the BIM formalism $$x = X^{\mathrm{BIM}}$$, $$\ f(x) = C(x)$$, $$\ c^{\mathrm{E}}_{i} \in \mathcal{C}^{E}$$ where $$\mathcal{C}^{\mathrm{E}} = \mathcal{C}^{\mathrm{PB}} \cup \mathcal{C}^{\mathrm{REF}} \cup \mathcal{C}^{\mathrm{BIM}}$$ and $$c^{\mathrm{I}}_{j} \in \mathcal{C}^{I}$$ where $$\mathcal{C}^{\mathrm{I}} = \mathcal{C}^{\mathrm{INEQ}}$$.

Interior-point methods can be straightforwardly derived within the framework of barrier methods.
For this we consider the following barrier problem:

$$
\begin{equation}
    \begin{aligned}
        & \min \limits_{x, s} \ f(x) - \mu \sum \limits_{i=1}^{\lvert \mathcal{C}^{\mathrm{I}} \rvert} \log s_{i} \\
        & \mathrm{s.t.} \; \; c^{\mathrm{E}}(x) = 0 \\
        & \quad \; \; \; c^{\mathrm{I}}(x) - s = 0 \\
    \end{aligned}
    \label{barrier_problem}
\end{equation}
$$

where $$s$$ is the vector of slack variables and the second term in the objective function is called the barrier term with $$\mu > 0$$ barrier parameter.
We note that the barrier term implicitly imposes an inequality constraint on the slack variables due to the logarithm function: $$s \ge 0$$.
It is easy to see that the barrier problem is not equivalent to the original non-linear program for $$\mu > 0$$.
However, as $$\mu \to 0$$ the solution of the barrier problem approaches that of problem $$\ref{opt_problem}$$.
Therefore, the idea of the barrier method is to find an approximate solution of the original problem by using an appropriate sequence of positive barrier parameters that converges to zero.
The basic algorithm is based on the [Karush–Kuhn–Tucker](https://en.wikipedia.org/wiki/Karush%E2%80%93Kuhn%E2%80%93Tucker_conditions) (KKT) conditions of the barrier problem:

$$
\begin{equation}
	\begin{aligned}
		\nabla f(x) - J_{\mathrm{E}}^{T}(x)y - J_{\mathrm{I}}^{T}(x)z = 0 \\
		Sz - \mu e = 0 \\
		c^{\mathrm{E}}(x) = 0 \\
		c^{\mathrm{I}}(x) - s = 0 \\
	\end{aligned}
\end{equation}
$$

where the $$J_{\mathrm{E}}(x)$$ and $$J_{\mathrm{I}}(x)$$ are the Jacobian matrices of the equality and inequality functions, respectively, and
$$y$$ and $$z$$ are their Lagrange multipliers.
Also, we use the following additional notations: $$S = \mathrm{diag}(s)$$ and $$Z = \mathrm{diag}(z)$$ are diagonal matrices, $$I$$ is the identity matrix and $$e = (1, \dots, 1)^{T}$$.

Now we can apply the previously discussed Newton-Raphson method to solve the non-linear system of KKT:

$$
\begin{equation}
	\begin{pmatrix}
		\nabla_{xx}L & 0 & -J_{\mathrm{E}}^{T}(x) & -J_{\mathrm{I}}^{T}(x) \\
		0 & Z & 0 & S \\
		J_{\mathrm{E}}(x) & 0 & 0 & 0 \\
		J_{\mathrm{I}}(x) & -I & 0 & 0 \\
	\end{pmatrix}
	\begin{pmatrix}
		p_{x} \\
		p_{s} \\
		p_{y} \\
		p_{z} \\
	\end{pmatrix}
    =
	\begin{pmatrix}
		\nabla f(x) - J_{\mathrm{E}}^{T}(x)y - J_{\mathrm{I}}^{T}(x)z \\
        Sz - \mu e \\
        c^{\mathrm{E}}(x) \\
        c^{\mathrm{I}}(x) - s \\
	\end{pmatrix}
	\label{primal_dual}
\end{equation}
$$

where the Lagrangian of the system is defined as:

$$
\begin{equation}
	L(x, s, y, z) = f(x) - y^{T} c^{\mathrm{E}}(x) - z^{T} \left( c^{\mathrm{I}}(x) - s \right)
	\label{lagrangian}
\end{equation}
$$

Eq. $$\ref{primal_dual}$$
is called the primal-dual system as it includes the dual variables beside the primal ones.
The primal-dual system is solved iteratively, i.e. in the $$(n+1)$$th iteration after obtaining $$p^{(n+1)} = (p_{x}^{(n+1)}, p_{s}^{(n+1)}, p_{y}^{(n+1)}, p_{z}^{(n+1)})$$ we can update the variables and the barrier parameter:

$$
\begin{equation}
	\begin{aligned}
		& x_{n+1} = x_{n} + \alpha_{x}^{(n+1)} p_{x}^{(n+1)} \\
		& s_{n+1} = s_{n} + \alpha_{s}^{(n+1)} p_{s}^{(n+1)} \\
		& y_{n+1} = y_{n} + \alpha_{y}^{(n+1)} p_{y}^{(n+1)} \\
		& z_{n+1} = z_{n} + \alpha_{z}^{(n+1)} p_{z}^{(n+1)} \\
		& \mu_{n+1} = g(\mu_{n}, x_{n+1}, s_{n+1}, y_{n+1}, z_{n+1}) \\
	\end{aligned}
\end{equation}
$$

where $$\alpha$$s denote the line search parameters and for the barrier parameter we used a fairly general function $$g$$.
There are several modern interior-point methods that propose different heuristic functions for computing line search and barrier parameters in order to cope with non-convexities and non-linearities and improve convergence rate.

## OPF variants
---------------

So far we have been focusing on one specific OPF problem, the economic dispatch that is one of the most basic types in the realm of OPF.
In this section we briefly discuss other models applied in the field.

In *economic dispatch* the demand is specified and we look for power generation with minimal cost.
Similarly, in *demand response* we try to optimize demands at load buses given by providing the generated power.
In the so-called *volt/var control* we optimize the combination of power loss, peak demand and power consumption with respect to the voltage level and reactive powers.

In the above problems the set of generators is specified and all of these generators are supposed to contribute to the total power generation.
However, in real industrial problems not all generators available in the grid need to be used.
Generators differ in many ways besides their generation curve: they have different start up and shut down time scales, minimum and maximum power generation, etc. that all need to be taken into account in the planning procedure.
Therefore, it is pretty desirable to allow specific generators to shut down in the optimization model.
In order to select the actual generators in use electricity grid operators solve the *unit commitment* (UC) problem.
UC problems can be considered as extensions of the ED problem, where the set of variables is extended by binary variables each responsible for including or excluding the actual generator in the optimization.
UC is therefore a mixed-integer non-linear programming that is an even more expensive problem.

Power grids are complex systems that include thousands of buses and transmission lines, where failure of any element can happen occasionally.
Another aspect therefore that needs to be considered is the security of the grid, i.e. providing OPF solution for such contingencies.
The corresponding set of problems is called *security constrained optimal power flow* (SCOPF).
SCOPF provides solution not only for the ideal unfailing case but at the same time for some contingencies as well.
These problems are therefore much larger scale problems including multiple of variables and constraints of the ED problem resulting again in a mixed-integer non-linear programming.
For example, the widely used $$N-1$$ contingency problem addresses all scenarios where a single component fails.

Finally, we note that a more general (and very large-scale) problem can be formulated by using both UC and SCOPF leading to the *security constrained unit commitment problem* (SCUC).

## Solving OPF problems
-----------------------

Solving AC-OPF problems by interior-point method is widely used as a reliable baseline approach. 
However, solving such problems by interior-point method is not cheap as it requires the computation of the Hessian of the Lagrangian $$\left( \nabla_{xx} L(x_{n}, s_{n}, y_{n}, z_{n}) \right)$$ at each iteration step $$n$$ (eq. $$\ref{primal_dual}$$).
Since the required computational time has a disadvantageous superlinear scaling with system size this can be prohibitive for solving large scale problems. 
Moreover, the scaling is even worse for OPF problems that are mixed-integer programming.

There are several approaches that address this issue by either simplifying the original AC-OPF problems or use other techniques to compute exact or approximate solution.

### Convex relaxations
----------------------

The first set of approximations we discuss is called convex relaxations.
The main idea of these approaches is to approximate the original non-convex optimization problem with a convex one.
Unlike in non-convex problems, any local minimum is a global minimum as well in convex problems.
Because of this and other useful features, there are very straightforward algorithms with excellent convergence rate to solve convex optimization problems[^Boyd04] [^Nocedal06].
To demonstrate convex relaxations let us consider again the economic dispatch problem using the BIM formulation with quadratic cost functions. 
As it can be shown, this problem - with some slight modification - can be reformulated as a quadratically constrained quadratic program (QCQP) using the complex voltages of the buses[^Low14]:

$$
\begin{equation}
	\begin{aligned}
		& \min \limits_{V \in \mathbb{C}^{N}} V^{H}CV \\
		& \mathrm{s.t.} \quad V^{H}M_{k}V \le m_{k} \quad k \in \mathcal{K} \\
	\end{aligned}
	\label{qcqp}
\end{equation}
$$

where $$^H$$ denotes conjugate transpose, $$M_{k}$$s are Hermitian matrices (i.e. $$M_{k}^{H} = M_{k}$$) and $$m_{k}$$s are real-valued vectors specifying the corresponding inequality constraints.
QCQP is still a non-convex problem that is also an NP-hard problem.
Let $$W = VV^{H}$$ denote a rank-1 positive semidefinite matrix.
Using the identity $$V^{H}MV = \mathrm{tr\ } MVV^{H} = \mathrm{tr\ } MW$$, for any Hermitian matrix we can transform eq. $$\ref{qcqp}$$ to the following problem:

$$
\begin{equation}
    \begin{aligned}
        & \min \limits_{W \in \mathbb{S}^{N}} \mathrm{tr\ }CW \\
        & \mathrm{s.t.} \quad \mathrm{tr\ }M_{k}W \le m_{k} \quad k \in \mathcal{K} \\
		& \quad \quad \ W \succeq 0 \\
		& \quad \quad \ \mathrm{rank\ } W = 1 \\
    \end{aligned}
\end{equation}
$$

where $$\mathbb{S}^{N}$$ denotes the space of $$N \times N$$ symmetric matrices, $$\mathrm{tr}$$ and $$\mathrm{rank}$$ are the trace and rank functions, respectively.
The above problem is convex in $$W$$ except the rank-1 equality constraint.
Removing this constraint leads to a semidefinite programming (SDP) and therefore it is called SDP relaxation of the OPF.
SDP introduces a convex superset of the optimization variables.
Other choices of convex supersets yield different relaxations like chordal or second-order cone programming (SOCP) that can be solved even more efficiently than SDP problems.
We note that all of these relaxations provide a lower bound to OPF and for some sufficient conditions these relaxations can be even exact[^Low14-II].
Also, an advantage of convex relaxation approaches over other approximations is that if a relaxed problem is infeasible then the original problem is also infeasible.

### DC-OPF
----------

One of the most widely used approximations is the DC-OPF approach.
Its name is pretty misleading as this method does not apply DC (instead of AC), although it removes the reactive power flow equations (and corresponding variables and constraints). 
It has three major assumptions[^Liu09]:
1. the resistance $$r_{ij}$$ of each branch is negligible, i.e. $$r_{ij} \approx 0$$
2. the bus voltage magnitudes are everywhere approximated by one per unit, i.e. $$v_{i} \approx 1$$
3. the voltage angle difference of each branch is very small, i.e. $$\cos \delta_{ij} \approx 1$$ and $$\sin\delta_{ij} \approx \delta_{ij}$$

Starting from eq. $$\ref{power_flow_z}$$ and applying the above approximations:

$$
\begin{equation}
	\begin{aligned}
		p_{ij} & = \frac{1}{r_{ij}^{2} + x_{ij}^{2}} \left[ r_{ij} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) + x_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) \right] \overset{\mathrm{approx.\ 1.}}{\approx} \\
		& \approx \frac{1}{x_{ij}} \left( v_{i}v_{j}\sin \delta_{ij} \right) \overset{\mathrm{approx.\ 2.}}{\approx} \frac{\sin \delta_{ij}}{x_{ij}} \overset{\mathrm{approx.\ 3.}}{\approx} \frac{\delta_{ij}}{x_{ij}} \quad & (i, j) \in \mathcal{E} \cup \mathcal{E}^{R} \\
		q_{ij} & = \frac{1}{r_{ij}^{2} + x_{ij}^{2}} \left[ x_{ij} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) + r_{ij} \left( v_{i} v_{j} \sin\delta_{ij} \right) \right] \overset{\mathrm{approx.\ 1.}}{\approx} \\
        & \approx \frac{1}{x_{ij}} \left( v_{i}^{2} - v_{i} v_{j} \cos\delta_{ij} \right) \overset{\mathrm{approx.\ 2.}}{\approx} \frac{1 - \cos \delta_{ij}}{x_{ij}} \overset{\mathrm{approx.\ 3.}}{\approx} 0 \quad & (i, j) \in \mathcal{E} \cup \mathcal{E}^{R}
    \end{aligned}
\end{equation}
$$

As we can see, DC-OPF reduces the original power flow problem significantly by removing several variables and constraints.
Also, the remaining set of constraints with a linear objective function results in a linear programming that can be solved very efficiently by interior-point or simplex methods.
DC-OPF has been demonstrated pretty useful for a wide variety of applications.
However, it also has several limitations among which the most severe one is that the solution of DC-OPF may not be even a feasible solution of AC-OPF.
In such situations some constraints need to be tightened and rerun the DC-OPF.

### Computational intelligence and machine learning 
---------------------------------------------------

The increasing uncertainty in grid conditions due to the integration of renewable resources (such as wind and solar) requires OPF problems to be solved near real-time in order to have the most accurate inputs reflecting the latest state of the system.
This in turn requires the grid operators to have the computational capacity of running consecutive instances of OPF problems with fast convergence time.
However, this is rather challenging for large-scale OPF problems - even using the DC-OPF approximation.
Therefore, as an alternative to interior-point methods, there has been intense research in the computational intelligence[^AlRashidi09] and machine learning[^Hasan20] fields.
Below we give a brief list of the most important approaches.

Computational intelligence[^AlRashidi09] techniques for solving OPF include:
- other optimization algorithms not requiring second derivatives like L-BFGS-B method, coordinate-descent algorithm, simulated annealing, particle swarm optimization and ant colony optimization
- evolutionary algorithms like evolutionary programming and evolutionary strategies
- genetic algorithms
- fuzzy set theory 

Among machine learning algorithms[^Hasan20] reinforcement, unsupervised and supervised (both regression and classification) learning approaches are used to solve OPF problems.
In general, these techniques shift the computational effort away from real-time to offline training.
Their most widely used applications include:
- direct prediction of OPF variables
- prediction of set-points of OPF variables for subsequent warm-start of interior-point methods
- prediction of the active constraints of OPF in order to build and solve significantly smaller reduced OPF problems

In a subsequent blog post we present a detailed description of these techniques.

---
[^Tong04]: J. Tong, “Overview of PJM energy market design, operation and experience,” in 2004 IEEE International Conference on Electric Utility Deregulation, Restructuring and Power Technologies. Proceedings, vol. 1. IEEE, 2004, pp. 24–27. 
[^Cain12]: M. B. Cain, R. P. Oneill, and A. Castillo, “History of optimal power flow and formulations,” Federal Energy Regulatory Commission, vol. 1, pp. 1–36, 2012.
[^Low14]: S. H. Low, "Convex Relaxation of Optimal Power Flow—Part I: Formulations and Equivalence," in IEEE Transactions on Control of Network Systems, vol. 1, no. 1, pp. 15-27, March 2014, doi: 10.1109/TCNS.2014.2309732.
[^Wood14]: A. J. Wood, B. F. Wollenberg and G. B. Sheblé, "Power generation, operation, and control," Hoboken, New Jersey: Wiley-Interscience, 2014
[^Liu09]: H. Liu, L. Tesfatsion and A. A. Chowdhury, "Locational marginal pricing basics for restructured wholesale power markets," 2009 IEEE Power & Energy Society General Meeting, Calgary, AB, 2009, pp. 1-8, doi: 10.1109/PES.2009.5275503.
[^Farivar13]: M. Farivar and S. H. Low, "Branch Flow Model: Relaxations and Convexification—Part I," in IEEE Transactions on Power Systems, vol. 28, no. 3, pp. 2554-2564, Aug. 2013, doi: 10.1109/TPWRS.2013.2255317.
[^Subhonmesh12]: B. Subhonmesh, S. H. Low and K. M. Chandy, "Equivalence of branch flow and bus injection models," 2012 50th Annual Allerton Conference on Communication, Control, and Computing (Allerton), Monticello, IL, 2012, pp. 1893-1899, doi: 10.1109/Allerton.2012.6483453.
[^Gholami14]: A. Gholami, J. Ansari, M. Jamei and A. Kazemi, "Environmental/economic dispatch incorporating renewable energy sources and plug-in vehicles," in IET Generation, Transmission & Distribution, vol. 8, no. 12, pp. 2183-2198, 12 2014, doi: 10.1049/iet-gtd.2014.0235.
[^Coffrin18]: C. Coffrin, R. Bent, K. Sundar, Y. Ng and M. Lubin, "PowerModels. JL: An Open-Source Framework for Exploring Power Flow Formulations," 2018 Power Systems Computation Conference (PSCC), Dublin, 2018, pp. 1-8, doi: 10.23919/PSCC.2018.8442948.
[^Zimmerman20]: R. D. Zimmerman, C. E. Murillo-Sanchez, "MATPOWER User’s Manual, Version 7.1. 2020. [Online], " Available: https://matpower.org/docs/MATPOWER-manual-7.1.pdf
[^Nocedal06]: J. Nocedal and S. J. Wrigh, "Numerical Optimization," New York: Springer, 2006
[^Wachter06]: A. Wächter and L. Biegler, "On the implementation of an interior-point filter line-search algorithm for large-scale nonlinear programming," Math. Program. 106, 25–57, 2006, doi: 10.1007/s10107-004-0559-y.
[^Boyd04]: S. Boyd and L. Vandenberghe, "Convex Optimization, " New York: Cambridge University Press, 2004
[^Low14-II]: S. H. Low, "Convex Relaxation of Optimal Power Flow—Part II: Exactness," in IEEE Transactions on Control of Network Systems, vol. 1, no. 2, pp. 177-189, June 2014, doi: 10.1109/TCNS.2014.2323634.
[^AlRashidi09]: M. R. AlRashidi and M. E. El-Hawary, "Applications of computational intelligence techniques for solving the revived optimal power flow problem," in Electric Power Systems Research, vol. 79, issue 4, 2009, doi: 10.1016/j.epsr.2008.10.004.
[^Hasan20]: F. Hasan, A. Kargarian and A. Mohammadi, "A Survey on Applications of Machine Learning for Optimal Power Flow," 2020 IEEE Texas Power and Energy Conference (TPEC), College Station, TX, USA, 2020, pp. 1-6, doi: 10.1109/TPEC48276.2020.9042547.
